services:
  test-e2e:
    build:
      context: ..
      dockerfile: tests/Dockerfile.test
    env_file:
      - ../.env
    environment:
      - KAITEN_E2E=1
    command: >
      tests/test_e2e_scenario.py -v
      --tb=long
      --timeout=600
      --log-cli-level=INFO
      -x

  test-overseer:
    build:
      context: ..
      dockerfile: tests/Dockerfile.test
    command: >
      tests/ -v
      --tb=short
      --cov=kaiten_mcp
      --cov-report=term-missing
      --cov-report=html:/app/coverage_html
      --cov-report=xml:/app/coverage.xml
      --cov-fail-under=100
      --timeout=60
      -x

  test-registration:
    build:
      context: ..
      dockerfile: tests/Dockerfile.test
    command: tests/test_layer1_registration.py -v --tb=short --timeout=30

  test-handlers-core:
    build:
      context: ..
      dockerfile: tests/Dockerfile.test
    command: tests/test_layer2_handlers/ -v --tb=short --timeout=60 -k "spaces or boards or columns or lanes or cards"

  test-handlers-card-resources:
    build:
      context: ..
      dockerfile: tests/Dockerfile.test
    command: tests/test_layer2_handlers/ -v --tb=short --timeout=60 -k "comments or checklists or blockers or relations or external_links or members or time_logs or tags or subscribers"

  test-handlers-company:
    build:
      context: ..
      dockerfile: tests/Dockerfile.test
    command: tests/test_layer2_handlers/ -v --tb=short --timeout=60 -k "documents or webhooks or automations or projects or roles or audit or service_desk or utilities or custom_properties or card_types"

  test-mcp-server:
    build:
      context: ..
      dockerfile: tests/Dockerfile.test
    command: tests/test_layer3_mcp_server.py -v --tb=short --timeout=60

  test-client-behavior:
    build:
      context: ..
      dockerfile: tests/Dockerfile.test
    command: tests/test_layer4_client.py -v --tb=short --timeout=60
